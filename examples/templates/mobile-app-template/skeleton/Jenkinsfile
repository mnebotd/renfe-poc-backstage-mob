pipeline {
  agent any

  environment {
    ANDROID_HOME     = 'C:\\Users\\mnebot\\AppData\\Local\\Android\\Sdk'
    ANDROID_SDK_ROOT = 'C:\\Users\\mnebot\\AppData\\Local\\Android\\Sdk'
    PATH = "${env.ANDROID_HOME}\\cmdline-tools\\latest\\bin;" +
           "${env.ANDROID_HOME}\\platform-tools;" +
           "${env.PATH}"
  }

  stages {

    stage('Checkout') {
      steps {
        bat 'git config core.longpaths true'
        checkout scm
      }
    }

    stage('Configure Android SDK') {
      steps {
        // Crear local.properties SIN espacios finales (FIX DEFINITIVO)
        bat '''
        powershell -Command ^
          "Set-Content -Path local.properties -Value 'sdk.dir=C:/Users/mnebot/AppData/Local/Android/Sdk' -NoNewline"
        '''

        // Verificación explícita (opcional pero recomendable)
        bat 'type local.properties'
      }
    }

    stage('Build') {
      steps {
        bat 'gradlew.bat assembleDebug'
      }
    }
  }

  post {
    success {
      echo 'Android build completed successfully'
    }
    failure {
      echo 'Android build failed'
    }
  }
}
